<!DOCTYPE html></!DOCTYPE html><html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>Superpowered keyword args in Haskell - Ben Kovach</title><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><style type="text/css">body{background-color:#eeeeee !important;font-family:"Ubuntu", serif !important}body .ui.container{font-family:"Ubuntu", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Kanit", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body div#neuron-theme-default-teal .zettel-content h1{background-color:rgba(0,181,173,0.1)}body div#neuron-theme-default-teal span.zettel-link-container span.zettel-link a{color:#00b5ad}body div#neuron-theme-default-teal span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#00b5ad}body div#neuron-theme-default-teal .deemphasized:hover div.item a:hover{color:#00b5ad !important}body div#neuron-theme-default-teal div#footnotes{border-top-color:#00b5ad}body div#neuron-theme-default-brown .zettel-content h1{background-color:rgba(165,103,63,0.1)}body div#neuron-theme-default-brown span.zettel-link-container span.zettel-link a{color:#a5673f}body div#neuron-theme-default-brown span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#a5673f}body div#neuron-theme-default-brown .deemphasized:hover div.item a:hover{color:#a5673f !important}body div#neuron-theme-default-brown div#footnotes{border-top-color:#a5673f}body div#neuron-theme-default-red .zettel-content h1{background-color:rgba(219,40,40,0.1)}body div#neuron-theme-default-red span.zettel-link-container span.zettel-link a{color:#db2828}body div#neuron-theme-default-red span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#db2828}body div#neuron-theme-default-red .deemphasized:hover div.item a:hover{color:#db2828 !important}body div#neuron-theme-default-red div#footnotes{border-top-color:#db2828}body div#neuron-theme-default-orange .zettel-content h1{background-color:rgba(242,113,28,0.1)}body div#neuron-theme-default-orange span.zettel-link-container span.zettel-link a{color:#f2711c}body div#neuron-theme-default-orange span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#f2711c}body div#neuron-theme-default-orange .deemphasized:hover div.item a:hover{color:#f2711c !important}body div#neuron-theme-default-orange div#footnotes{border-top-color:#f2711c}body div#neuron-theme-default-yellow .zettel-content h1{background-color:rgba(251,189,8,0.1)}body div#neuron-theme-default-yellow span.zettel-link-container span.zettel-link a{color:#fbbd08}body div#neuron-theme-default-yellow span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#fbbd08}body div#neuron-theme-default-yellow .deemphasized:hover div.item a:hover{color:#fbbd08 !important}body div#neuron-theme-default-yellow div#footnotes{border-top-color:#fbbd08}body div#neuron-theme-default-olive .zettel-content h1{background-color:rgba(181,204,24,0.1)}body div#neuron-theme-default-olive span.zettel-link-container span.zettel-link a{color:#b5cc18}body div#neuron-theme-default-olive span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#b5cc18}body div#neuron-theme-default-olive .deemphasized:hover div.item a:hover{color:#b5cc18 !important}body div#neuron-theme-default-olive div#footnotes{border-top-color:#b5cc18}body div#neuron-theme-default-green .zettel-content h1{background-color:rgba(33,186,69,0.1)}body div#neuron-theme-default-green span.zettel-link-container span.zettel-link a{color:#21ba45}body div#neuron-theme-default-green span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#21ba45}body div#neuron-theme-default-green .deemphasized:hover div.item a:hover{color:#21ba45 !important}body div#neuron-theme-default-green div#footnotes{border-top-color:#21ba45}body div#neuron-theme-default-blue .zettel-content h1{background-color:rgba(33,133,208,0.1)}body div#neuron-theme-default-blue span.zettel-link-container span.zettel-link a{color:#2185d0}body div#neuron-theme-default-blue span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#2185d0}body div#neuron-theme-default-blue .deemphasized:hover div.item a:hover{color:#2185d0 !important}body div#neuron-theme-default-blue div#footnotes{border-top-color:#2185d0}body div#neuron-theme-default-violet .zettel-content h1{background-color:rgba(100,53,201,0.1)}body div#neuron-theme-default-violet span.zettel-link-container span.zettel-link a{color:#6435c9}body div#neuron-theme-default-violet span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#6435c9}body div#neuron-theme-default-violet .deemphasized:hover div.item a:hover{color:#6435c9 !important}body div#neuron-theme-default-violet div#footnotes{border-top-color:#6435c9}body div#neuron-theme-default-purple .zettel-content h1{background-color:rgba(163,51,200,0.1)}body div#neuron-theme-default-purple span.zettel-link-container span.zettel-link a{color:#a333c8}body div#neuron-theme-default-purple span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#a333c8}body div#neuron-theme-default-purple .deemphasized:hover div.item a:hover{color:#a333c8 !important}body div#neuron-theme-default-purple div#footnotes{border-top-color:#a333c8}body div#neuron-theme-default-pink .zettel-content h1{background-color:rgba(224,57,151,0.1)}body div#neuron-theme-default-pink span.zettel-link-container span.zettel-link a{color:#e03997}body div#neuron-theme-default-pink span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#e03997}body div#neuron-theme-default-pink .deemphasized:hover div.item a:hover{color:#e03997 !important}body div#neuron-theme-default-pink div#footnotes{border-top-color:#e03997}body div#neuron-theme-default-grey .zettel-content h1{background-color:rgba(118,118,118,0.1)}body div#neuron-theme-default-grey span.zettel-link-container span.zettel-link a{color:#767676}body div#neuron-theme-default-grey span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#767676}body div#neuron-theme-default-grey .deemphasized:hover div.item a:hover{color:#767676 !important}body div#neuron-theme-default-grey div#footnotes{border-top-color:#767676}body div#neuron-theme-default-black .zettel-content h1{background-color:rgba(27,28,29,0.1)}body div#neuron-theme-default-black span.zettel-link-container span.zettel-link a{color:#1b1c1d}body div#neuron-theme-default-black span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#1b1c1d}body div#neuron-theme-default-black .deemphasized:hover div.item a:hover{color:#1b1c1d !important}body div#neuron-theme-default-black div#footnotes{border-top-color:#1b1c1d}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.84999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) span.zettel-link a, div.item a{color:#808080 !important}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f8f8f8}body div.zettel-view .zettel-content pre{padding:0.5em 0.5em 0.5em 0.5em;overflow:auto;max-width:100%}body div.zettel-view .zettel-content div.pandoc-code{margin-left:auto;margin-right:auto}body div.zettel-view .zettel-content div.pandoc-code pre{background-color:#f8f8f8}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .ui.label.zettel-tag a.tag-inner{color:#000000}body .ui.label.zettel-tag a.tag-inner a{color:#000000}body span.zettel-link-container span.zettel-link a{font-weight:bold;text-decoration:none}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.raw{border:solid 1px #ff0000}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}body nav.top-menu{padding-top:1em;padding-bottom:1em;justify-content:center;text-align:center}body nav.top-menu > *{padding-left:0px;padding-right:0px}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}</style><link href="https://fonts.googleapis.com/css?family=Kanit|Ubuntu|Roboto+Mono&amp;display=swap" rel="stylesheet" /><script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><meta content="Ben Kovach" name="author" /><meta content="As programs get larger and more complex, the components therein also
grow. This happens on several levels; we often have to deal with growing
applications, packages, modules, and test suites. This blog post is
about how to deal with the humble function.
" name="description" /><link href="https://kovach.me/99c052ab.html" rel="canonical" /><meta content="Superpowered keyword args in Haskell" property="og:title" /><meta content="Ben Kovach" property="og:site_name" /><meta content="article" property="og:type" /><script type="application/ld+json">[]</script><style type="text/css">pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style></head><body><div class="ui fluid container" id="neuron-theme-default-orange"><nav class="top-menu"><div class="ui inverted compact neuron icon menu orange"><a class="left item" href="." title="Home"><i class="home icon"></i></a><a class="left item" href="search.html" title="Search Zettels"><i class="search icon"></i></a><a class="center item" href="https://github.com/5outh/zettelkasten/edit/master/99c052ab.md" title="Edit this Zettel"><i class="edit icon"></i></a><a class="right item" href="z-index.html" title="All Zettels (z-index)"><i class="tree icon"></i></a></div></nav><div class="ui text container" id="zettel-container" style="position: relative"><div id="zettel-container-anchor" style="position: absolute; top: -24px; left: 0"></div><div class="zettel-view"><article class="ui raised attached segment zettel-content"><h1>Superpowered keyword args in Haskell</h1><div class="pandoc"><h2 id="overview">Overview</h2><p>As programs get larger and more complex, the components therein also grow. This happens on several levels; we often have to deal with growing applications, packages, modules, and test suites. This blog post is about how to deal with the humble function.</p><p>If you’ve ever worked on a production codebase, you know that <em>one</em> function that lives in a module that several others depend on. It sits at the very core of your application, growing in complexity to support the ever-expanding needs of the business. It is the entrypoint into a sea of complexity…and it has several positional arguments that mean nothing without documentation and other context. It is a powerful and useful beast, but it must be tamed.</p><h2 id="domain">Domain</h2><p>Maybe you work on an information system for posts of some kind where a common operation is fetching a set of posts. Various filters/sorts need to be applied conditionally based on whatever the caller needs:</p><ul><li>Filter - Posted by a certain person</li><li>Filter - Posted before or after a certain date</li><li>Filter - Liked by a particular other user</li><li>Filter - Commented on by a particular other user</li><li>Filter - Accessible to a particular user</li><li>Filter - Public only</li><li>Sort - Popular posts (top n posts ordered by likes)</li><li>Sort - Most controversial posts (top n posts ordered by number of comments)</li><li>Sort - Most linked posts (linked to by other posts)</li></ul><h2 id="a-function">A function</h2><p>The type signature for the function that does this type of fetch could look something like this:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="kw">newtype</span><span class=""> </span><span class="dt">UserId</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">UserId</span><span class=""> </span><span class="dt">Integer</span>
<span class="kw">data</span><span class=""> </span><span class="dt">TimeSpan</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">TimeSpan</span><span class=""> {</span><span class="ot"> start ::</span><span class=""> </span><span class="dt">UTCTime</span><span class="">,</span><span class="ot"> end ::</span><span class=""> </span><span class="dt">UTCTime</span><span class=""> }</span>
<span class="kw">data</span><span class=""> </span><span class="dt">Sort</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">Popular</span><span class=""> </span><span class="op">|</span><span class=""> </span><span class="dt">Controversial</span><span class=""> </span><span class="op">|</span><span class=""> </span><span class="dt">MostLinked</span>

<span class="">fetchPosts</span>
<span class="ot">  ::</span><span class=""> </span><span class="dt">MonadFetch</span><span class=""> m</span>
<span class="">  </span><span class="ot">=&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">TimeSpan</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Bool</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Sort</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> m [</span><span class="dt">Post</span><span class="">]</span>
<span class="">fetchPosts userId timeSpan likedBy commentedOnBy accessibleBy publicOnly </span><span class="fu">sort</span>
<span class="">  </span><span class="ot">=</span><span class=""> </span><span class="co">-- omitted</span>
</code></pre></div><p>This works, but is very error prone. Even though we’re making use of newtype wrappers, the positional arguments could easily get mixed up, causing, for instance, a fetch for posts <code>likedBy</code> a user instead of the expected posts <code>commentedOnBy</code> by a user. Every time a call to this function is made, you have to be careful to provide the correct arguments in the correct order.</p><h2 id="a-safer-approach">A safer approach</h2><p>One way to improve this situation is to make extensive use of <code>newtype</code> wrappers and avoid <span class="zettel-link-container cf"><span class="zettel-link"><a href="0aad2e98.html">Boolean Blindness</a></span></span>. This is a pretty common idiom, and it helps a bit:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="kw">data</span><span class=""> </span><span class="dt">VisibilityFilter</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">PublicOnly</span><span class=""> </span><span class="op">|</span><span class=""> </span><span class="dt">PublicOrPrivate</span>
<span class="kw">newtype</span><span class=""> </span><span class="dt">AuthorId</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">AuthorId</span><span class=""> </span><span class="dt">UserId</span><span class=""> </span><span class="co">-- and a bunch more, you get the picture</span>

<span class="">fetchPosts</span>
<span class="ot">  ::</span><span class=""> </span><span class="dt">MonadFetch</span><span class=""> m</span>
<span class="">  </span><span class="ot">=&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">AuthorId</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">TimeSpan</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">LikedBy</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">CommentedOnBy</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">AccessibleBy</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">VisibilityFilter</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Sort</span>
<span class="">  </span><span class="ot">-&gt;</span><span class=""> m [</span><span class="dt">Post</span><span class="">]</span>
<span class="">fetchPosts userId timeSpan likedBy commentedOnBy accessibleBy publicOnly </span><span class="fu">sort</span>
<span class="">  </span><span class="ot">=</span><span class=""> </span><span class="co">-- ...</span>
</code></pre></div><p>This is safer, but arguably more annoying to work with due to all the manual packing of newtypes that needs to be done, and every call is pretty noisy. Consider what fetching all public posts for a given author would look like:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="">main </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  posts </span><span class="ot">&lt;-</span><span class=""> runFetch </span><span class="op">$</span>
<span class="">    fetchPosts</span>
<span class="">      (</span><span class="dt">Just</span><span class=""> (</span><span class="dt">AuthorId</span><span class=""> (</span><span class="dt">UserId</span><span class=""> </span><span class="dv">1</span><span class="">)))</span>
<span class="">      </span><span class="dt">Nothing</span>
<span class="">      </span><span class="dt">Nothing</span>
<span class="">      </span><span class="dt">Nothing</span>
<span class="">      </span><span class="dt">Nothing</span>
<span class="">      </span><span class="dt">PublicOnly</span>
<span class="">      </span><span class="dt">SortPopular</span>
<span class="">  </span><span class="co">-- ... do something with posts</span>
</code></pre></div><p>That is a lot of typing “I don’t care” for one function call, and, although we have moved them from runtime bugs to compile time errors, argument transposition is still annoying problem that we have to deal with somehow.</p><p>Additionally, every time we add a new filter to this function, we need to update all of the places it is called. This is a very general function that can be used in many different ways, so that could be a significant number of callsites depending on the sixe of the project.</p><h2 id="the-z24e8a789cf-pattern">The <span class="zettel-link-container cf"><span class="zettel-link"><a href="24e8a789.html">Keyword Args</a></span></span> Pattern</h2><p>The pattern I will describe here solves the argument transposition issue and reduces specifying “I don’t care” for very general function call. The trick, if you can call it that, is to stuff all of those parameters into a data type, then make that data type defaultable and allow overriding its fields to deal with special cases like filters and sorting. It reminds me of <span class="zettel-link-container cf"><span class="zettel-link"><a href="24e8a789.html">Keyword Args</a></span></span> in languages like Python, so I’m loosely naming it the <em>Keyword Args Pattern</em></p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="kw">data</span><span class=""> </span><span class="dt">FetchPostsArgs</span><span class=""> </span><span class="ot">=</span>
<span class="">  {</span><span class="ot"> authorId ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> timeSpan ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">TimeSpan</span>
<span class="">  ,</span><span class="ot"> likedBy ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> commentedOnBy ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> accessibleBy ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> visibilityFilter ::</span><span class=""> </span><span class="dt">VisibilityFilter</span>
<span class="">  ,</span><span class="ot"> sort ::</span><span class=""> </span><span class="dt">Sort</span>
<span class="">  }</span>

<span class="ot">defaultFetchPostsArgs ::</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">defaultFetchPostsArgs </span><span class="ot">=</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">  { authorId </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , timeSpan </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , likedBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , commentedOnBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , accessibleBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , visibilityFilter </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , </span><span class="fu">sort</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">SortPopular</span>
<span class="">  }</span>

<span class="ot">fetchPosts ::</span><span class=""> </span><span class="dt">MonadFetch</span><span class=""> m </span><span class="ot">=&gt;</span><span class=""> </span><span class="dt">FetchPostsArgs</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> m [</span><span class="dt">Post</span><span class="">]</span>
<span class="">fetchPosts </span><span class="dt">FetchPostsArgs</span><span class="">{</span><span class="op">..</span><span class="">} </span><span class="ot">=</span><span class=""> </span><span class="co">-- ...</span>
</code></pre></div><p>now fetching all public posts for a given author looks like this:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="">main </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  posts </span><span class="ot">&lt;-</span><span class=""> runFetch </span><span class="op">$</span>
<span class="">    fetchPosts </span><span class="op">$</span><span class=""> defaultFetchPostsArgs { authorId </span><span class="ot">=</span><span class=""> </span><span class="dt">UserId</span><span class=""> </span><span class="dv">1</span><span class=""> }</span>
<span class="">  </span><span class="co">-- ... do something with posts</span>
</code></pre></div><p>not only is that easier to write, but it also lets us explicitly specify what we want to change about the general functionality (“fetch all posts”) without needing to explicitly specify what we don’t care about changing (all other filters and sort methods)</p><p>worth noting that <code>RecordWildCards</code> is utilized here to retain exactly the same argument names as before, so the function body would not need to change.</p><h2 id="adding-functionality">Adding functionality</h2><p>suppose we now want to not only filter by a single user, but we also want to search for posts that contain certain tags. We could modify <code>FetchPostsArgs</code> to support this case:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="kw">data</span><span class=""> </span><span class="dt">FetchPostsArgs</span><span class=""> </span><span class="ot">=</span>
<span class="">  {</span><span class="ot"> authorId ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> timeSpan ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">TimeSpan</span>
<span class="">  ,</span><span class="ot"> likedBy ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> commentedOnBy ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> accessibleBy ::</span><span class=""> </span><span class="dt">Maybe</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> visibilityFilter ::</span><span class=""> </span><span class="dt">VisibilityFilter</span>
<span class="">  ,</span><span class="ot"> sort ::</span><span class=""> </span><span class="dt">Sort</span>
<span class="">  ,</span><span class="ot"> tags ::</span><span class=""> [</span><span class="dt">Tag</span><span class="">]</span>
<span class="">  }</span>

<span class="ot">defaultFetchPostsArgs ::</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">defaultFetchPostsArgs </span><span class="ot">=</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">  { authorId </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , timeSpan </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , likedBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , commentedOnBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , accessibleBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , visibilityFilter </span><span class="ot">=</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , </span><span class="fu">sort</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">SortPopular</span>
<span class="">  , tags </span><span class="ot">=</span><span class=""> []</span>
<span class="">  }</span>
</code></pre></div><p>and update the body of <code>fetchPosts</code> as needed.</p><h2 id="utilizing-z0b7171c6cfs-and-z1b112336cfs">Utilizing <span class="zettel-link-container cf"><span class="zettel-link"><a href="0b7171c6.html">Monoid</a></span></span>s and <span class="zettel-link-container cf"><span class="zettel-link"><a href="1b112336.html">Smart Constructor</a></span></span>s</h2><p><code>fetchPostArgs</code> looks a lot like a <span class="zettel-link-container cf"><span class="zettel-link"><a href="0b7171c6.html">Monoid</a></span></span>, and we can certainly frame it that way, with a little bit of finagling:</p><div class="pandoc-code highlighted"><pre><code class="haskell">
<span class="kw">data</span><span class=""> </span><span class="dt">Visibility</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">Public</span><span class=""> </span><span class="op">|</span><span class=""> </span><span class="dt">Private</span><span class=""> </span><span class="op">|</span><span class=""> </span><span class="dt">Protected</span>

<span class="kw">data</span><span class=""> </span><span class="dt">FetchPostsArgs</span><span class=""> </span><span class="ot">=</span>
<span class="">  {</span><span class="ot"> authorId ::</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> timeSpan ::</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">TimeSpan</span>
<span class="">  ,</span><span class="ot"> likedBy ::</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> commentedOnBy ::</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> accessibleBy ::</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">UserId</span>
<span class="">  ,</span><span class="ot"> forbiddenVisibilities ::</span><span class=""> [</span><span class="dt">Visibility</span><span class="">]</span>
<span class="">  ,</span><span class="ot"> sorts ::</span><span class=""> [</span><span class="dt">Sort</span><span class="">]</span>
<span class="">  ,</span><span class="ot"> tags ::</span><span class=""> [</span><span class="dt">Tag</span><span class="">]</span>
<span class="">  }</span>

<span class="ot">defaultFetchPostsArgs ::</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">defaultFetchPostsArgs </span><span class="ot">=</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">  { authorId </span><span class="ot">=</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , timeSpan </span><span class="ot">=</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , likedBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , commentedOnBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , accessibleBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Last</span><span class=""> </span><span class="dt">Nothing</span>
<span class="">  , forbiddenVisibilities </span><span class="ot">=</span><span class=""> []</span>
<span class="">  , sorts </span><span class="ot">=</span><span class=""> []</span>
<span class="">  , tags </span><span class="ot">=</span><span class=""> []</span>
<span class="">  }</span>

<span class="kw">instance</span><span class=""> </span><span class="dt">Semigroup</span><span class=""> </span><span class="dt">FetchPostsArgs</span><span class=""> </span><span class="kw">where</span><span class=""> </span><span class="co">-- ... pairwise &lt;&gt;</span>
<span class="kw">instance</span><span class=""> </span><span class="dt">Semigroup</span><span class=""> </span><span class="dt">FetchPostsArgs</span><span class=""> </span><span class="kw">where</span><span class=""> </span><span class="co">-- ... every field is `mempty`</span>
</code></pre></div><p>with this formulation, we can build up <span class="zettel-link-container cf"><span class="zettel-link"><a href="1b112336.html">Smart Constructor</a></span></span>s and compose them to create more specific queries. For example, suppose we want to find <strong>all public posts by User 2 tagged “Haskell” and “Code” posted less than 7 days ago, that I (User 1) liked</strong>. Some <span class="zettel-link-container cf"><span class="zettel-link"><a href="1b112336.html">Smart Constructor</a></span></span>s can help here:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">publicOnlyArgs ::</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">publicOnlyArgs </span><span class="ot">=</span><span class=""> </span><span class="fu">mempty</span><span class=""> { forbiddenVisibilities </span><span class="ot">=</span><span class=""> [</span><span class="dt">Private</span><span class="">, </span><span class="dt">Protected</span><span class="">] }</span>

<span class="ot">likedByArgs ::</span><span class=""> </span><span class="dt">UserId</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">likedByArgs userId </span><span class="ot">=</span><span class=""> </span><span class="fu">mempty</span><span class=""> { likedBy </span><span class="ot">=</span><span class=""> </span><span class="dt">Last</span><span class=""> (</span><span class="dt">Just</span><span class=""> userId) }</span>

<span class="ot">authoredByArgs ::</span><span class=""> </span><span class="dt">UserId</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">authoredByArgs userid </span><span class="ot">=</span><span class=""> </span><span class="fu">mempty</span><span class=""> { authorId </span><span class="ot">=</span><span class=""> </span><span class="dt">Last</span><span class=""> (</span><span class="dt">Just</span><span class=""> userId) }</span>

<span class="ot">taggedArgs ::</span><span class=""> </span><span class="dt">Tag</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">taggedArgs tag </span><span class="ot">=</span><span class=""> </span><span class="fu">mempty</span><span class=""> { tags </span><span class="ot">=</span><span class=""> [tag] }</span>

<span class="ot">postedAfter ::</span><span class=""> </span><span class="dt">UTCTime</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">IO</span><span class=""> </span><span class="dt">FetchPostsArgs</span>
<span class="">postedAfter time </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  now </span><span class="ot">&lt;-</span><span class=""> getCurrentTime</span>
<span class="">  </span><span class="fu">pure</span><span class=""> </span><span class="op">$</span><span class=""> </span><span class="fu">mempty</span><span class=""> { timeSpan </span><span class="ot">=</span><span class=""> </span><span class="dt">Last</span><span class=""> (</span><span class="dt">TimeSpan</span><span class=""> time now) }</span>
</code></pre></div><p>and our fetch looks like:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="">main </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  sevenDaysAgo </span><span class="ot">&lt;-</span><span class=""> subtractDays </span><span class="dv">7</span><span class=""> </span><span class="op">&lt;$&gt;</span><span class=""> getCurrentTime</span>
<span class="">  timeArgs </span><span class="ot">&lt;-</span><span class=""> postedAfter sevenDaysAgo</span>

<span class="">  posts </span><span class="ot">&lt;-</span><span class=""> runFetch </span><span class="op">$</span>
<span class="">    fetchPosts</span>
<span class="">      </span><span class="op">$</span><span class="">  timeArgs</span>
<span class="">      </span><span class="op">&lt;&gt;</span><span class=""> publicOnlyArgs</span>
<span class="">      </span><span class="op">&lt;&gt;</span><span class=""> authoredByArgs (</span><span class="dt">UserId</span><span class=""> </span><span class="dv">2</span><span class="">)</span>
<span class="">      </span><span class="op">&lt;&gt;</span><span class=""> likedByArgs (</span><span class="dt">UserId</span><span class=""> </span><span class="dv">1</span><span class="">)</span>
<span class="">      </span><span class="op">&lt;&gt;</span><span class=""> taggedArgs (</span><span class="dt">Tag</span><span class=""> </span><span class="st">&quot;Haskell&quot;</span><span class="">)</span>
<span class="">      </span><span class="op">&lt;&gt;</span><span class=""> taggedArgs (</span><span class="dt">Tag</span><span class=""> </span><span class="st">&quot;Code&quot;</span><span class="">)</span>

<span class="">  </span><span class="co">-- ... do something with posts</span>
</code></pre></div><p>Using <span class="zettel-link-container cf"><span class="zettel-link"><a href="0b7171c6.html">Monoid</a></span></span>s gives us better composition of common operations in many cases. Here, I might argue that taking this step is unnecessary, but it is at least helpful for illustrative purposes.</p><h3 id="a-small-note">A small note</h3><p>Suppose we were writing a function <code>fetchPostsForUser</code> instead, which always required a <code>UserId</code> to fetch posts for. In this case, it does make sense to pull that individual argument outside of the <code>Args</code> data type and provide it as a required parameter, e.g.:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">fetchPostsForUser ::</span><span class=""> </span><span class="dt">MonadFetch</span><span class=""> m </span><span class="ot">=&gt;</span><span class=""> </span><span class="dt">UserId</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">FetchPostsArgs</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> m [</span><span class="dt">Post</span><span class="">]</span>
</code></pre></div><p>The conceptual reason for this is that <code>fetchPostsForUser</code> has no default behavior without a <code>UserId</code>, and we need default behavior for the <code>Monoid</code> to remain sensible.</p><h2 id="in-short">In Short</h2><p>If you are dealing with functions that:</p><ul><li>Have many positional arguments</li><li>Are called in a variety of ways to accomplish specific goals</li><li>Have a well-behaved “default” operation, where the arguments simply specify refinemesnts on that default operation</li></ul><p>you might want to consider trying out this pattern.</p></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2020-09-22T10:30">2020-09-22</time></div></div></article><nav class="ui bottom attached segment deemphasized"><div class="ui grid"><div class="fourteen wide column"><div class="ui header" title="Zettels that link here (branching or not)">Backlinks</div><ul><li><span class="zettel-link-container cf"><span class="zettel-link" data-inverted="" data-position="right center" data-tooltip="Tags: home"><a href=".">Writings by Ben Kovach</a></span></span></li></ul></div><div class="two wide column"><span class="ui right ribbon label zettel-tag" title="Tag"><a class="tag-inner" href="search.html?tag=Haskell" title="See all zettels tagged &#39;Haskell&#39;">Haskell</a></span><p></p></div></div></nav></div></div><div class="ui one column grid footer-version"><div class="center aligned column"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron" /></a></div></div></div></div></body></html>