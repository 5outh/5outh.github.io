<!DOCTYPE html></!DOCTYPE html><html lang="en"><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><title>Generating artwork with Haskell - Ben Kovach</title><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><style type="text/css">body{background-color:#eeeeee !important;font-family:"Ubuntu", serif !important}body .ui.container{font-family:"Ubuntu", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Kanit", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body div#neuron-theme-default-teal .zettel-content h1{background-color:rgba(0,181,173,0.1)}body div#neuron-theme-default-teal span.zettel-link-container span.zettel-link a{color:#00b5ad}body div#neuron-theme-default-teal span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#00b5ad}body div#neuron-theme-default-teal .deemphasized:hover div.item a:hover{color:#00b5ad !important}body div#neuron-theme-default-teal div#footnotes{border-top-color:#00b5ad}body div#neuron-theme-default-brown .zettel-content h1{background-color:rgba(165,103,63,0.1)}body div#neuron-theme-default-brown span.zettel-link-container span.zettel-link a{color:#a5673f}body div#neuron-theme-default-brown span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#a5673f}body div#neuron-theme-default-brown .deemphasized:hover div.item a:hover{color:#a5673f !important}body div#neuron-theme-default-brown div#footnotes{border-top-color:#a5673f}body div#neuron-theme-default-red .zettel-content h1{background-color:rgba(219,40,40,0.1)}body div#neuron-theme-default-red span.zettel-link-container span.zettel-link a{color:#db2828}body div#neuron-theme-default-red span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#db2828}body div#neuron-theme-default-red .deemphasized:hover div.item a:hover{color:#db2828 !important}body div#neuron-theme-default-red div#footnotes{border-top-color:#db2828}body div#neuron-theme-default-orange .zettel-content h1{background-color:rgba(242,113,28,0.1)}body div#neuron-theme-default-orange span.zettel-link-container span.zettel-link a{color:#f2711c}body div#neuron-theme-default-orange span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#f2711c}body div#neuron-theme-default-orange .deemphasized:hover div.item a:hover{color:#f2711c !important}body div#neuron-theme-default-orange div#footnotes{border-top-color:#f2711c}body div#neuron-theme-default-yellow .zettel-content h1{background-color:rgba(251,189,8,0.1)}body div#neuron-theme-default-yellow span.zettel-link-container span.zettel-link a{color:#fbbd08}body div#neuron-theme-default-yellow span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#fbbd08}body div#neuron-theme-default-yellow .deemphasized:hover div.item a:hover{color:#fbbd08 !important}body div#neuron-theme-default-yellow div#footnotes{border-top-color:#fbbd08}body div#neuron-theme-default-olive .zettel-content h1{background-color:rgba(181,204,24,0.1)}body div#neuron-theme-default-olive span.zettel-link-container span.zettel-link a{color:#b5cc18}body div#neuron-theme-default-olive span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#b5cc18}body div#neuron-theme-default-olive .deemphasized:hover div.item a:hover{color:#b5cc18 !important}body div#neuron-theme-default-olive div#footnotes{border-top-color:#b5cc18}body div#neuron-theme-default-green .zettel-content h1{background-color:rgba(33,186,69,0.1)}body div#neuron-theme-default-green span.zettel-link-container span.zettel-link a{color:#21ba45}body div#neuron-theme-default-green span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#21ba45}body div#neuron-theme-default-green .deemphasized:hover div.item a:hover{color:#21ba45 !important}body div#neuron-theme-default-green div#footnotes{border-top-color:#21ba45}body div#neuron-theme-default-blue .zettel-content h1{background-color:rgba(33,133,208,0.1)}body div#neuron-theme-default-blue span.zettel-link-container span.zettel-link a{color:#2185d0}body div#neuron-theme-default-blue span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#2185d0}body div#neuron-theme-default-blue .deemphasized:hover div.item a:hover{color:#2185d0 !important}body div#neuron-theme-default-blue div#footnotes{border-top-color:#2185d0}body div#neuron-theme-default-violet .zettel-content h1{background-color:rgba(100,53,201,0.1)}body div#neuron-theme-default-violet span.zettel-link-container span.zettel-link a{color:#6435c9}body div#neuron-theme-default-violet span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#6435c9}body div#neuron-theme-default-violet .deemphasized:hover div.item a:hover{color:#6435c9 !important}body div#neuron-theme-default-violet div#footnotes{border-top-color:#6435c9}body div#neuron-theme-default-purple .zettel-content h1{background-color:rgba(163,51,200,0.1)}body div#neuron-theme-default-purple span.zettel-link-container span.zettel-link a{color:#a333c8}body div#neuron-theme-default-purple span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#a333c8}body div#neuron-theme-default-purple .deemphasized:hover div.item a:hover{color:#a333c8 !important}body div#neuron-theme-default-purple div#footnotes{border-top-color:#a333c8}body div#neuron-theme-default-pink .zettel-content h1{background-color:rgba(224,57,151,0.1)}body div#neuron-theme-default-pink span.zettel-link-container span.zettel-link a{color:#e03997}body div#neuron-theme-default-pink span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#e03997}body div#neuron-theme-default-pink .deemphasized:hover div.item a:hover{color:#e03997 !important}body div#neuron-theme-default-pink div#footnotes{border-top-color:#e03997}body div#neuron-theme-default-grey .zettel-content h1{background-color:rgba(118,118,118,0.1)}body div#neuron-theme-default-grey span.zettel-link-container span.zettel-link a{color:#767676}body div#neuron-theme-default-grey span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#767676}body div#neuron-theme-default-grey .deemphasized:hover div.item a:hover{color:#767676 !important}body div#neuron-theme-default-grey div#footnotes{border-top-color:#767676}body div#neuron-theme-default-black .zettel-content h1{background-color:rgba(27,28,29,0.1)}body div#neuron-theme-default-black span.zettel-link-container span.zettel-link a{color:#1b1c1d}body div#neuron-theme-default-black span.zettel-link-container span.zettel-link a:hover{color:#ffffff;background-color:#1b1c1d}body div#neuron-theme-default-black .deemphasized:hover div.item a:hover{color:#1b1c1d !important}body div#neuron-theme-default-black div#footnotes{border-top-color:#1b1c1d}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.84999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f8f8f8}body div.zettel-view .zettel-content pre{padding:0.5em 0.5em 0.5em 0.5em;overflow:auto;max-width:100%}body div.zettel-view .zettel-content div.pandoc-code{margin-left:auto;margin-right:auto}body div.zettel-view .zettel-content div.pandoc-code pre{background-color:#f8f8f8}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.backlinks-container{background-color:#eeeeee !important}body ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body ul.context-list > li{list-style-type:lower-roman}body span.zettel-link-container span.zettel-link a{font-weight:bold;text-decoration:none}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}body nav.top-menu{padding-top:1em;padding-bottom:1em;justify-content:center;text-align:center}body nav.top-menu > *{padding-left:0px;padding-right:0px}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}</style><link href="https://fonts.googleapis.com/css?family=Kanit|Ubuntu|Roboto+Mono&amp;display=swap" rel="stylesheet" /><script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><meta content="Ben Kovach" name="author" /><meta content="I’ve been creating z:/Generative art consistently for about six months
now. People are starting to ask what my stack looks like, and until now
I haven’t had anything to point at; I’d like to change that today! I’m
going to lay out my approach in this blog post, and we’ll put together
something simpl" name="description" /><link href="https://kovach.me/Generating_artwork_with_Haskell.html" rel="canonical" /><meta content="Generating artwork with Haskell" property="og:title" /><meta content="Ben Kovach" property="og:site_name" /><meta content="article" property="og:type" /><script type="application/ld+json">[]</script><style type="text/css">pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style></head><body><div class="ui fluid container" id="neuron-theme-default-blue"><nav class="top-menu"><div class="ui inverted compact neuron icon menu blue"><a class="left item" href="." title="Home"><i class="home icon"></i></a><a class="left item" href="search.html" title="Search Zettels"><i class="search icon"></i></a><a class="center item" href="https://github.com/5outh/zettelkasten/edit/master/Generating artwork with Haskell.md" title="Edit this Zettel"><i class="edit icon"></i></a><a class="right item" href="z-index.html" title="All Zettels (z-index)"><i class="tree icon"></i></a></div></nav><div class="ui text container" id="zettel-container" style="position: relative"><div id="zettel-container-anchor" style="position: absolute; top: -24px; left: 0"></div><div class="zettel-view"><article class="ui raised attached segment zettel-content"><h1>Generating artwork with Haskell</h1><div class="pandoc"><h3 id="introduction">Introduction</h3><p>I’ve been creating <span class="zettel-link-container cf"><span class="zettel-link"><a href="Generative.html">Generative</a></span></span> art consistently for about six months now. People are starting to ask what my stack looks like, and until now I haven’t had anything to point at; I’d like to change that today! I’m going to lay out my approach in this blog post, and we’ll put together something simple using the stack I’ve been using to generate art.</p><p>The long and short of it:</p><ul><li>I use <span class="zettel-link-container cf"><span class="zettel-link"><a href="Haskell.html">Haskell</a></span></span></li><li>I use Cairo</li><li>It rocks!</li></ul><p>Here’s what we’ll be making:</p><p><img src="https://ben-kovach-blog-assets.s3.amazonaws.com/images/final_colored_grid.png" width="100%" style="display:block;margin:auto"></img></p><p>I’m assuming some familiarity with <span class="zettel-link-container cf"><span class="zettel-link"><a href="Haskell.html">Haskell</a></span></span> in this post. I’m happy to help others learn, but won’t cover some of the minutiae here - my contact information is totally open if you’d like to reach out!</p><h3 id="getting-set-up">Getting set up</h3><p>You’ll need the following <span class="zettel-link-container cf"><span class="zettel-link"><a href="Haskell.html">Haskell</a></span></span> packages to run this script, if you want to follow along:</p><ul><li>cairo</li><li>colour</li><li>hsnoise</li><li>linear</li><li>MonadRandom</li><li>mtl</li><li>time</li><li>transformers</li></ul><p>You’ll also need <code>cairo</code> (the C library) installed on your system.</p><h3 id="background">Background</h3><h4 id="cairo">Cairo</h4><p><code>Cairo</code> is a 2D graphics library written in C. It’s pretty low-level, and handles things like drawing lines, rectangles or circles on a digital canvas. The specifics aren’t super important here, but it’s good to know what a <code>surface</code> and a <code>source</code> are.</p><p>For our purposes, we can consider a <code>surface</code> to be something like a canvas - a drawing surface. A <code>source</code> is a medium - the “digital paint” we use on the <code>surface</code>. In our case, this will only ever be a flat color. It can technically be a gradient, a texture, or even another <code>surface</code>.</p><h4 id="haskell">Haskell</h4><p>First off, I’ve been writing <span class="zettel-link-container cf"><span class="zettel-link"><a href="Haskell.html">Haskell</a></span></span> code for a long time. I’m very familiar with it, so it was very natural for me to try out this workflow. My choice to go in this direction is largely rooted in familiarity. I followed <a href="http://www.tylerlhobbs.com/">Tyler Hobbs</a>’s lead for a little while, writing Processing code through <a href="http://www.tylerlhobbs.com/writings/using-quil-for-artwork">Quil in Clojure</a>. It worked really well for a while, and I learned a lot of fundamentals regarding generative art (and Lisp!) this way. However, there were some things I just never got <em>quite</em> working, and I didn’t feel like I was as productive as I could be. So, I gave this new stack a shot.</p><p>Pretty immediately, I saw some improvements:</p><blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">I switched my genart stack to haskell/cairo a few days ago. Here&#39;s what changed:<br><br>- Deterministic random generation (seeding works across many libs)<br>- Image generation is super fast<br>- Image scaling is much easier<br>- Moving stuff around is slower, but usually correct</p>&mdash; Benjamin Kovach (@BendotK) <a href="https://twitter.com/BendotK/status/964186342564524032?ref_src=twsrc%5Etfw">February 15, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>For context, I never got seeding working in my old stack. In <span class="zettel-link-container cf"><span class="zettel-link"><a href="Haskell.html">Haskell</a></span></span>, pretty much every library involving randomness works with <code>StdGen</code> (which is part of the standard library, and has a nice API). Scaling images is just a matter of applying a scaling matrix to the whole image (we’ll see this later); it was a pretty manual process before. Changing code around is a bazillion times easier because I don’t really have to worry about messing my data types up - typically the compiler will yell until it becomes satisfied, at which point running the code does what I’d expect*.</p><p>* Not always, of course. But the adage of “if it compiles it works” does have some merit, especially in the world of generative art, where happy accidents are totally welcome.</p><p>I know that these things are totally <em>possible</em> with my old tech stack, I just didn’t find it intuitive for some reason. These things frustrated me to the point where I wanted to try something new.</p><h3 id="how-about-some-code">How about some code?</h3><p>Okay, first we’ll import all the libraries we need and set some GHC extensions:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">{-# LANGUAGE RecordWildCards  #-}</span>
<span class="ot">{-# LANGUAGE TypeApplications #-}</span>
<span class="kw">module</span><span class=""> </span><span class="dt">Main</span><span class=""> </span><span class="kw">where</span>

<span class="kw">import</span><span class="">           </span><span class="dt">Control.Arrow</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Control.Concurrent</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Control.Monad.Random</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Control.Monad.Reader</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Data.Colour.RGBSpace</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Data.Colour.RGBSpace.HSV</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Data.Foldable</span><span class="">            (for_)</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Data.List</span><span class="">                (nub)</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Data.Semigroup</span><span class="">           ((&lt;&gt;))</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Data.Time.Clock.POSIX</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Graphics.Rendering.Cairo</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Linear.V2</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Linear.Vector</span>
<span class="kw">import</span><span class=""> </span><span class="kw">qualified</span><span class=""> </span><span class="dt">Numeric.Noise.Perlin</span><span class="">     </span><span class="kw">as</span><span class=""> </span><span class="dt">P</span>
<span class="kw">import</span><span class="">           </span><span class="dt">Text.Printf</span>
</code></pre></div><p>Now we can talk about our domain.</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="kw">data</span><span class=""> </span><span class="dt">World</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">World</span>
<span class="">  {</span><span class="ot"> worldWidth  ::</span><span class=""> </span><span class="dt">Int</span>
<span class="">  ,</span><span class="ot"> worldHeight ::</span><span class=""> </span><span class="dt">Int</span>
<span class="">  ,</span><span class="ot"> worldSeed   ::</span><span class=""> </span><span class="dt">Int</span>
<span class="">  ,</span><span class="ot"> worldScale  ::</span><span class=""> </span><span class="dt">Double</span>
<span class="">  }</span>

<span class="kw">type</span><span class=""> </span><span class="dt">Generate</span><span class=""> a </span><span class="ot">=</span><span class=""> </span><span class="dt">RandT</span><span class=""> </span><span class="dt">StdGen</span><span class=""> (</span><span class="dt">ReaderT</span><span class=""> </span><span class="dt">World</span><span class=""> </span><span class="dt">Render</span><span class="">) a</span>
</code></pre></div><p>The <code>World</code> type just holds all of the information we may want to access at any point in our program.</p><p>An expression of type <code>Generate a</code> wraps three distinct types of functionality in the following layers. Working from the inside out…</p><ul><li><code>Render</code> is a type that ships with <code>cairo</code> - it is a newtype wrapper around <code>ReaderT Cairo</code>, where <code>Cairo</code> handles cairo context information. This isn’t super important to understand completely, but the key is that it allows us to interface with the cairo C library in a managed way.</li><li>One layer up, we’re working with <code>ReaderT World</code>, which will let us read environment information from the <code>World</code>.</li><li>The final layer to consider is the <code>RandT StdGen</code> layer from the <code>MonadRandom</code> package, which allows us to generate random values from a random number generator.</li></ul><p>The result is a type that allows all of those side effects to coexist, but effectively separates randomness and rendering. We can write functions of type <code>Render a</code> and <code>lift</code> them into the <code>Generate</code> context when needed, effectively separating random generation logic from rendering logic.</p><p>I’ve written a short helper function because <code>lift . lift</code> gets annoying to type after a while and doesn’t communicate intent very well:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="co">-- | Lift a Cairo action into a Generate action</span>
<span class="ot">cairo ::</span><span class=""> </span><span class="dt">Render</span><span class=""> a </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Generate</span><span class=""> a</span>
<span class="">cairo </span><span class="ot">=</span><span class=""> lift </span><span class="op">.</span><span class=""> lift</span>
</code></pre></div><p>Those are the basic building blocks that will let us interface with the libraries we need. There’s some boilerplate/setup we’ll need to run <code>Generate</code> expressions, so let’s get that out of the way and get something (nothing?) rendering:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">renderSketch ::</span><span class=""> </span><span class="dt">Generate</span><span class=""> ()</span>
<span class="">renderSketch </span><span class="ot">=</span><span class=""> </span><span class="fu">pure</span><span class=""> () </span><span class="co">-- no-op</span>

<span class="ot">main ::</span><span class=""> </span><span class="dt">IO</span><span class=""> ()</span>
<span class="">main </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  seed </span><span class="ot">&lt;-</span><span class=""> </span><span class="fu">round</span><span class=""> </span><span class="op">.</span><span class=""> (</span><span class="op">*</span><span class="dv">1000</span><span class="">) </span><span class="op">&lt;$&gt;</span><span class=""> getPOSIXTime</span>
<span class="">  </span><span class="kw">let</span>
<span class="">    stdGen </span><span class="ot">=</span><span class=""> mkStdGen seed</span>
<span class="">    width </span><span class="ot">=</span><span class=""> </span><span class="dv">60</span>
<span class="">    height </span><span class="ot">=</span><span class=""> </span><span class="dv">60</span>
<span class="">    scaleAmount </span><span class="ot">=</span><span class=""> </span><span class="dv">20</span>

<span class="">    scaledWidth </span><span class="ot">=</span><span class=""> </span><span class="fu">round</span><span class=""> </span><span class="op">$</span><span class=""> </span><span class="fu">fromIntegral</span><span class=""> width </span><span class="op">*</span><span class=""> scaleAmount</span>
<span class="">    scaledHeight </span><span class="ot">=</span><span class=""> </span><span class="fu">round</span><span class=""> </span><span class="op">$</span><span class=""> </span><span class="fu">fromIntegral</span><span class=""> height </span><span class="op">*</span><span class=""> scaleAmount</span>

<span class="">  surface </span><span class="ot">&lt;-</span><span class=""> createImageSurface </span><span class="dt">FormatARGB32</span><span class=""> scaledWidth scaledHeight</span>
<span class="">  </span><span class="co">-- The &quot;world&quot; thinks the width and height are the initial values, not scaled.</span>
<span class="">  </span><span class="kw">let</span><span class=""> world </span><span class="ot">=</span><span class=""> </span><span class="dt">World</span><span class=""> width height seed scaleAmount</span>

<span class="">  void</span>
<span class="">    </span><span class="op">.</span><span class=""> renderWith surface</span>
<span class="">    </span><span class="op">.</span><span class=""> </span><span class="fu">flip</span><span class=""> runReaderT world</span>
<span class="">    </span><span class="op">.</span><span class=""> </span><span class="fu">flip</span><span class=""> runRandT stdGen</span>
<span class="">    </span><span class="op">$</span><span class=""> </span><span class="kw">do</span>
<span class="">      cairo </span><span class="op">$</span><span class=""> scale scaleAmount scaleAmount</span>
<span class="">      renderSketch</span>

<span class="">  </span><span class="fu">putStrLn</span><span class=""> </span><span class="st">&quot;Generating art...&quot;</span>
<span class="">  surfaceWriteToPNG surface</span>
<span class="">    </span><span class="op">$</span><span class=""> </span><span class="st">&quot;images/example_sketch/&quot;</span>
<span class="">    </span><span class="op">&lt;&gt;</span><span class=""> </span><span class="fu">show</span><span class=""> seed </span><span class="op">&lt;&gt;</span><span class=""> </span><span class="st">&quot;-&quot;</span><span class=""> </span><span class="op">&lt;&gt;</span><span class=""> </span><span class="fu">show</span><span class=""> (</span><span class="fu">round</span><span class="ot"> scaleAmount ::</span><span class=""> </span><span class="dt">Int</span><span class="">) </span><span class="op">&lt;&gt;</span><span class=""> </span><span class="st">&quot;.png&quot;</span>
<span class="">  surfaceWriteToPNG surface </span><span class="st">&quot;images/example_sketch/latest.png&quot;</span>
</code></pre></div><p>Running this should produce two blank images, assuming the <code>images/example_sketch/</code> directory exists: <code>images/example_sketch/&lt;seed&gt;-20.png</code> and <code>images/example_sketch/latest.png</code>.</p><p>We’ll fill out <code>renderSketch</code> in a minute, but for now it’s just an art generator that does absolutely nothing. The rest of this is sort of important.</p><p>First, we grab the current <code>POSIX</code> time in milliseconds for use as our <code>StdGen</code> seed. This is important because it lets us re-use the seed to re-generate the artwork if we need/want to. Some initial variables are set, like the width, height, and how much we want to scale the final image. We create an image surface in <code>ARGB32</code> format to write to, and initialize our <code>World</code>. The next blob runs the <code>renderSketch</code> action with the program’s parameters we just set up. Before rendering the sketch, we can scale by a specified amount (in this case 20), which will effectively “blow up” the image without losing any quality if needed. The next two bits just write out the file to two locations: A timestamped one, which gives us the “seed” value, and a special file called <code>latest.png</code> that just holds the last image generated.</p><p>Just a couple of things about this:</p><ul><li>Because it’s so easy to up the <code>scaleAmount</code>, it makes sense to generate art at a comfortable size for speed purposes.</li><li>The <code>latest.png</code> file is super useful because it allows us to update a static file when the program is run. When I’m working on artwork, I automatically rebuild and regenerate these files on save. Having <code>latest.png</code> around means I can just leave my image viewer open and it will automatically refresh so I don’t have to jump around the file system.</li><li>Our program <em>thinks</em> that the image surface’s dimensions are <code>width x height</code>, but the actual size of the generated image will be scaled. This is really useful because it allows us to think in terms of a statically sized image, even when we might want to start blowing things up. I typically work with a 100x100 workspace, then blow up images as big as 10000x10000 when needed. Almost everything scales using <code>Double</code>s in the <code>cairo</code> API, so it’s really easy to get nice scaling properties while staying comfortable within a single coordinate space.</li></ul><h3 id="lets-render-something">Let’s render something</h3><p>The rest of this post will focus on filling out the <code>renderSketch</code> function, which will actually render something to our <code>Surface</code>.</p><p>Refresher time. We are trying to get here:</p><p><img src="https://ben-kovach-blog-assets.s3.amazonaws.com/images/final_colored_grid.png" width="100%" style="display:block;margin:auto"></img></p><p>Generating the background would be a good start, so let’s do that.</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">getSize ::</span><span class=""> </span><span class="dt">Num</span><span class=""> a </span><span class="ot">=&gt;</span><span class=""> </span><span class="dt">Generate</span><span class=""> (a, a)</span>
<span class="">getSize </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  (w, h) </span><span class="ot">&lt;-</span><span class=""> asks (worldWidth </span><span class="op">&amp;&amp;&amp;</span><span class=""> worldHeight)</span>
<span class="">  </span><span class="fu">pure</span><span class=""> (</span><span class="fu">fromIntegral</span><span class=""> w, </span><span class="fu">fromIntegral</span><span class=""> h)</span>

<span class="ot">fillScreen ::</span><span class=""> (</span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> a) </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Generate</span><span class=""> ()</span>
<span class="">fillScreen color opacity </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  (w, h) </span><span class="ot">&lt;-</span><span class=""> getSize </span><span class="op">@</span><span class="dt">Double</span>
<span class="">  cairo </span><span class="op">$</span><span class=""> </span><span class="kw">do</span>
<span class="">    rectangle </span><span class="dv">0</span><span class=""> </span><span class="dv">0</span><span class=""> w h</span>
<span class="">    color opacity </span><span class="op">*&gt;</span><span class=""> fill</span>

<span class="ot">hsva ::</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> ()</span>
<span class="">hsva h s v </span><span class="ot">=</span><span class=""> setSourceRGBA channelRed channelGreen channelBlue</span>
<span class=""> </span><span class="kw">where</span><span class=""> </span><span class="dt">RGB</span><span class="">{</span><span class="op">..</span><span class="">} </span><span class="ot">=</span><span class=""> hsv h s v</span>

<span class="ot">eggshell ::</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> ()</span>
<span class="">eggshell </span><span class="ot">=</span><span class=""> hsva </span><span class="dv">71</span><span class=""> </span><span class="fl">0.13</span><span class=""> </span><span class="fl">0.96</span>

<span class="ot">renderSketch ::</span><span class=""> </span><span class="dt">Generate</span><span class=""> ()</span>
<span class="">renderSketch </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  fillScreen eggshell </span><span class="dv">1</span>
</code></pre></div><p>Okay that’s a bit more code, sorry. Still have a bit to set up because <code>cairo</code> <em>is</em> a pretty low level library and we’re building from scratch.</p><p>In a nutshell:</p><ul><li><code>getSize</code> gets the dimensions of the surface from the world, and converts them to a specified numeric type.</li><li><code>fillScreen</code> takes a color and an <code>alpha</code> value (an opacity param between 0 and 1) and fills the screen with that color.</li><li><code>hsva</code> lets us use the HSV color space instead of RGB which is <a href="https://www.kirupa.com/design/little_about_color_hsv_rgb.htm">much more in-line with how we think about color</a>. It sets the <code>source</code> (paint) to this color for the next drawing operation.</li><li><code>eggshell</code> is the color we want to fill the screen with.</li><li><code>renderSketch</code> now fills the screen with fully opaque <code>eggshell</code>.</li></ul><p>I consider <code>Double -&gt; Render a</code> to be the type of a <code>Color</code>, which might seem weird. But I want to be able to control opacity, and don’t consider that a part of a color’s definition. However, it’s a tuneable attribute of color, so this representation works nicely.</p><p>Anyway, when we run this script, we should see a completely <code>eggshell</code> square:</p><p><img src="https://ben-kovach-blog-assets.s3.amazonaws.com/images/background.png" width="100%" style="display:block;margin:auto"></img></p><h3 id="rendering-something-neat">Rendering something neat</h3><p>Progress! The next step is to draw a grid of quadrilaterals. Notably, we’ll need a concrete notion of two things:</p><ul><li>Points on a grid</li><li>Quadrilaterals</li></ul><p>We’ll start by generating perfect squares, and then add some variance to those squares later.</p><h4 id="points-on-a-grid">Points on a grid</h4><p>Well, first we need the idea of a <code>Point</code> in 2d space. Fortunately the <code>linear</code> library comes in handy here with its <code>V2</code> type. <code>V2 Double</code> will do (a two dimensional vector of <code>Double</code>s).</p><h4 id="quadrilaterals">Quadrilaterals</h4><p>For this program, a <code>Quad</code> (quadrilateral) is well-represented by four points in space. I’ve arbitrarily chosen them to be in counter-clockwise order, starting from the top left:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="co">--  a---d</span>
<span class="co">--  |   |</span>
<span class="co">--  b---c</span>
<span class="kw">data</span><span class=""> </span><span class="dt">Quad</span><span class=""> </span><span class="ot">=</span><span class=""> </span><span class="dt">Quad</span>
<span class="">  {</span><span class="ot"> quadA ::</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="dt">Double</span>
<span class="">  ,</span><span class="ot"> quadB ::</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="dt">Double</span>
<span class="">  ,</span><span class="ot"> quadC ::</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="dt">Double</span>
<span class="">  ,</span><span class="ot"> quadD ::</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="dt">Double</span>
<span class="">  } </span><span class="kw">deriving</span><span class=""> (</span><span class="dt">Eq</span><span class="">, </span><span class="dt">Ord</span><span class="">)</span>
</code></pre></div><p>* Note: I totally draw little ascii drawings like this in my comments all the time. It helps!</p><p>A simple way to think about points on a grid is a <code>V2 Int</code> - that is, a vector with integral coordinates. Let’s go that route for now, and generate some <code>Quad</code>s!</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">fromIntegralVector ::</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="dt">Int</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="dt">Double</span>
<span class="">fromIntegralVector (</span><span class="dt">V2</span><span class=""> x y) </span><span class="ot">=</span><span class=""> </span><span class="dt">V2</span><span class=""> (</span><span class="fu">fromIntegral</span><span class=""> x) (</span><span class="fu">fromIntegral</span><span class=""> y)</span>

<span class="ot">genQuadGrid ::</span><span class=""> </span><span class="dt">Generate</span><span class=""> [</span><span class="dt">Quad</span><span class="">]</span>
<span class="">genQuadGrid </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  (w, h) </span><span class="ot">&lt;-</span><span class=""> getSize </span><span class="op">@</span><span class="dt">Int</span>
<span class="">  vectors </span><span class="ot">&lt;-</span><span class=""> replicateM </span><span class="dv">800</span><span class=""> </span><span class="op">$</span><span class=""> </span><span class="kw">do</span>
<span class="">    v </span><span class="ot">&lt;-</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="op">&lt;$&gt;</span><span class=""> getRandomR (</span><span class="dv">3</span><span class="">, w </span><span class="ot">`div`</span><span class=""> </span><span class="dv">2</span><span class=""> </span><span class="op">-</span><span class=""> </span><span class="dv">3</span><span class="">) </span><span class="op">&lt;*&gt;</span><span class=""> getRandomR (</span><span class="dv">3</span><span class="">, h </span><span class="ot">`div`</span><span class=""> </span><span class="dv">2</span><span class=""> </span><span class="op">-</span><span class=""> </span><span class="dv">3</span><span class="">)</span>
<span class="">    </span><span class="fu">pure</span><span class=""> </span><span class="op">$</span><span class=""> v </span><span class="op">^*</span><span class=""> </span><span class="dv">2</span>
<span class="">  </span><span class="fu">pure</span><span class=""> </span><span class="op">.</span><span class=""> nub </span><span class="op">.</span><span class=""> </span><span class="fu">flip</span><span class=""> </span><span class="fu">map</span><span class=""> vectors </span><span class="op">$</span><span class=""> \v </span><span class="ot">-&gt;</span>
<span class="">    </span><span class="kw">let</span><span class=""> v&#39; </span><span class="ot">=</span><span class=""> fromIntegralVector v</span>
<span class="">    </span><span class="kw">in</span><span class=""> </span><span class="dt">Quad</span><span class=""> v&#39; (v&#39; </span><span class="op">^+^</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="dv">0</span><span class=""> </span><span class="fl">1.5</span><span class="">) (v&#39; </span><span class="op">^+^</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="fl">1.5</span><span class=""> </span><span class="fl">1.5</span><span class="">) (v&#39; </span><span class="op">^+^</span><span class=""> </span><span class="dt">V2</span><span class=""> </span><span class="fl">1.5</span><span class=""> </span><span class="dv">0</span><span class="">)</span>
</code></pre></div><p>We produce a grid of quads by:</p><ul><li>Grabbing the dimensions of our surface as <code>Int</code>s</li><li>Getting 800 random integral points in the integer grid (We multiply by two here for slightly bigger shapes, and trim off a margin*)</li><li>Adding the appropriate offsets to them with the <code>^+^</code> (vector addition) operator to produce <code>Quad</code> coordinates around the specified start point</li><li>Filtering out duplicates.</li></ul><p>* Another way of dealing with this would be to double the scaling, and half the width and height, and just use any integer coordinates. But this works too and lets us adjust the margins a little better (with 3 padding vs 2 or 4)</p><p>Armed with this, we need to be able to render the <code>Quad</code>s by drawing the path around them:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">renderClosedPath ::</span><span class=""> [</span><span class="dt">V2</span><span class=""> </span><span class="dt">Double</span><span class="">] </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> ()</span>
<span class="">renderClosedPath (</span><span class="dt">V2</span><span class=""> x y</span><span class="op">:</span><span class="">vs) </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  newPath</span>
<span class="">  moveTo x y</span>
<span class="">  for_ vs </span><span class="op">$</span><span class=""> \v </span><span class="ot">-&gt;</span><span class=""> </span><span class="kw">let</span><span class=""> </span><span class="dt">V2</span><span class=""> x&#39; y&#39; </span><span class="ot">=</span><span class=""> v </span><span class="kw">in</span><span class=""> lineTo x&#39; y&#39;</span>
<span class="">  closePath</span>
<span class="">renderClosedPath [] </span><span class="ot">=</span><span class=""> </span><span class="fu">pure</span><span class=""> ()</span>

<span class="ot">renderQuad ::</span><span class=""> </span><span class="dt">Quad</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> ()</span>
<span class="">renderQuad </span><span class="dt">Quad</span><span class="">{</span><span class="op">..</span><span class="">} </span><span class="ot">=</span><span class=""> renderClosedPath [quadA, quadB, quadC, quadD]</span>
</code></pre></div><p>Then we can render the grid:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">darkGunmetal ::</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> ()</span>
<span class="">darkGunmetal </span><span class="ot">=</span><span class=""> hsva </span><span class="dv">170</span><span class=""> </span><span class="fl">0.30</span><span class=""> </span><span class="fl">0.16</span>

<span class="ot">renderSketch ::</span><span class=""> </span><span class="dt">Generate</span><span class=""> ()</span>
<span class="">renderSketch </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  fillScreen eggshell </span><span class="dv">1</span>

<span class="">  cairo </span><span class="op">$</span><span class=""> setLineWidth </span><span class="fl">0.15</span>

<span class="">  quads </span><span class="ot">&lt;-</span><span class=""> genQuadGrid</span>

<span class="">  cairo </span><span class="op">$</span><span class=""> for_ quads </span><span class="op">$</span><span class=""> \quad </span><span class="ot">-&gt;</span><span class=""> </span><span class="kw">do</span>
<span class="">    renderQuad quad</span>
<span class="">    darkGunmetal </span><span class="dv">1</span><span class=""> </span><span class="op">*&gt;</span><span class=""> stroke</span>
</code></pre></div><p>Voila:</p><p><img src="https://ben-kovach-blog-assets.s3.amazonaws.com/images/grid.png" width="100%" style="display:block;margin:auto"></img></p><h3 id="more-variance">More Variance</h3><p>Let’s add some variance. First, we’ll add some Perlin noise to the quad coordinates: A super easy way to get cool looking, smooth movement.</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">quadAddNoise ::</span><span class=""> </span><span class="dt">Quad</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Generate</span><span class=""> </span><span class="dt">Quad</span>
<span class="">quadAddNoise </span><span class="dt">Quad</span><span class="">{</span><span class="op">..</span><span class="">} </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  perlinSeed </span><span class="ot">&lt;-</span><span class=""> </span><span class="fu">fromIntegral</span><span class=""> </span><span class="op">&lt;$&gt;</span><span class=""> asks worldSeed</span>

<span class="">  </span><span class="kw">let</span>
<span class="">    perlinOctaves </span><span class="ot">=</span><span class=""> </span><span class="dv">5</span>
<span class="">    perlinScale </span><span class="ot">=</span><span class=""> </span><span class="fl">0.1</span>
<span class="">    perlinPersistance </span><span class="ot">=</span><span class=""> </span><span class="fl">0.5</span>
<span class="">    perlinNoise</span>
<span class="">      </span><span class="ot">=</span><span class=""> P.perlin (</span><span class="fu">round</span><span class=""> perlinSeed) perlinOctaves perlinScale perlinPersistance</span>
<span class="">    perlin2d (</span><span class="dt">V2</span><span class=""> x y)</span>
<span class="">      </span><span class="ot">=</span><span class=""> P.noiseValue perlinNoise (x </span><span class="op">+</span><span class=""> perlinSeed, y </span><span class="op">+</span><span class=""> perlinSeed, perlinSeed) </span><span class="op">-</span><span class=""> </span><span class="fl">0.5</span>
<span class="">    addNoise v </span><span class="ot">=</span><span class=""> </span><span class="kw">let</span><span class=""> noise </span><span class="ot">=</span><span class=""> perlin2d v </span><span class="kw">in</span><span class=""> v </span><span class="op">^+^</span><span class=""> </span><span class="dt">V2</span><span class=""> (noise </span><span class="op">/</span><span class=""> </span><span class="dv">5</span><span class="">) (noise </span><span class="op">/</span><span class=""> </span><span class="dv">8</span><span class="">)</span>

<span class="">  </span><span class="fu">pure</span><span class=""> </span><span class="op">$</span><span class=""> </span><span class="dt">Quad</span>
<span class="">    (addNoise quadA)</span>
<span class="">    (addNoise quadB)</span>
<span class="">    (addNoise quadC)</span>
<span class="">    (addNoise quadD)</span>
</code></pre></div><p>A large chunk of this is just interfacing with the <code>hsnoise</code> library. There are some parameters we need to provide to <code>P.perlin</code> that you can largely ignore. Check out <a href="http://flafla2.github.io/2014/08/09/perlinnoise.html">Adrian’s Soapbox</a> for a good explanation, if you wish. The key piece here is that the <code>worldSeed</code> is added to the <code>x</code> and <code>y</code> values here when passed into the <code>perlinNoise</code> function. If this was not added, we would see the same variance every time. The short way of saying this is that Perlin noise is deterministic; we can introduce variance by offsetting by our (varying) seed.</p><p>The attentive reader might recognize that the only reason we’re really in <code>Generate</code> here is to get access to the size of the surface. This could also have been written inside the <code>ReaderT World</code> layer just as well and <code>lift</code>ed into the <code>Generate</code> context later.</p><p>Anyway, we generate noise at each of the four quad points, subtract 0.5 from it to allow us to move up and to the left, then add a scaled version of it to each of the four quad points.</p><p>Applying it, we get a some wiggly quadrilaterals:</p><p><img src="https://ben-kovach-blog-assets.s3.amazonaws.com/images/noisy_quads.png" width="100%" style="display:block;margin:auto"></img></p><h3 id="even-more-variance">Even More Variance</h3><p>We’re very nearly there, but still missing a couple of points of variance:</p><ol><li>We’re not filling any squares, we’re just stroking them all</li><li>We’re only using one color (<code>darkGunmetal</code>), and we want to vary the colors.</li></ol><p>This is best illustrated with code. <code>renderSketch</code> becomes:</p><div class="pandoc-code highlighted"><pre><code class="haskell"><span class="ot">teaGreen ::</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> ()</span>
<span class="">teaGreen </span><span class="ot">=</span><span class=""> hsva </span><span class="dv">81</span><span class=""> </span><span class="fl">0.25</span><span class=""> </span><span class="fl">0.94</span>

<span class="ot">vividTangerine ::</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> ()</span>
<span class="">vividTangerine </span><span class="ot">=</span><span class=""> hsva </span><span class="dv">11</span><span class=""> </span><span class="fl">0.40</span><span class=""> </span><span class="fl">0.92</span>

<span class="ot">englishVermillion ::</span><span class=""> </span><span class="dt">Double</span><span class=""> </span><span class="ot">-&gt;</span><span class=""> </span><span class="dt">Render</span><span class=""> ()</span>
<span class="">englishVermillion </span><span class="ot">=</span><span class=""> hsva </span><span class="dv">355</span><span class=""> </span><span class="fl">0.68</span><span class=""> </span><span class="fl">0.84</span>

<span class="ot">renderSketch ::</span><span class=""> </span><span class="dt">Generate</span><span class=""> ()</span>
<span class="">renderSketch </span><span class="ot">=</span><span class=""> </span><span class="kw">do</span>
<span class="">  fillScreen eggshell </span><span class="dv">1</span>

<span class="">  cairo </span><span class="op">$</span><span class=""> setLineWidth </span><span class="fl">0.15</span>

<span class="">  quads </span><span class="ot">&lt;-</span><span class=""> genQuadGrid</span>
<span class="">  noisyQuads </span><span class="ot">&lt;-</span><span class=""> </span><span class="fu">traverse</span><span class=""> quadAddNoise quads</span>

<span class="">  for_ noisyQuads </span><span class="op">$</span><span class=""> \quad </span><span class="ot">-&gt;</span><span class=""> </span><span class="kw">do</span>
<span class="">    strokeOrFill </span><span class="ot">&lt;-</span><span class=""> weighted [(fill, </span><span class="fl">0.4</span><span class="">), (stroke, </span><span class="fl">0.6</span><span class="">)]</span>
<span class="">    color </span><span class="ot">&lt;-</span><span class=""> uniform</span>
<span class="">       [ teaGreen</span>
<span class="">       , vividTangerine</span>
<span class="">       , englishVermillion</span>
<span class="">       , darkGunmetal</span>
<span class="">       ]</span>
<span class="">    cairo </span><span class="op">$</span><span class=""> </span><span class="kw">do</span>
<span class="">      renderQuad quad</span>
<span class="">      color </span><span class="dv">1</span><span class=""> </span><span class="op">*&gt;</span><span class=""> strokeOrFill</span>
</code></pre></div><p>We use two functions from <code>MonadRandom</code> here:</p><ul><li><code>weighted</code> grabs a value out of a list with the given weight. We will <code>fill</code> 40% of the time and <code>stroke</code> 60% of the time.</li><li><code>uniform</code> assigns the same weight to every value in a list and does the same thing. All four colors have an equal chance of being chosen.</li></ul><p>Rendering has been lifted with <code>cairo</code> into it’s own block inside the <code>for_</code>, instead of wrapping the whole thing, to allow for random generation within the loop.</p><p>Kablam! Art!</p><p><img src="https://ben-kovach-blog-assets.s3.amazonaws.com/images/final_colored_grid.png" width="100%" style="display:block;margin:auto"></img></p><h3 id="concluding-remarks">Concluding remarks</h3><h4 id="seeding">Seeding</h4><p>I used this seed to generate this final image: <code>1520476193207</code>. If you’ve been following along, try fixing the seed and generating it on your own!</p><h4 id="modifying-non-random-variables">Modifying non-random variables</h4><p>One thing I haven’t shown off is that you can screw around with anything inside a <code>Render</code> block without affecting the RNG. Try changing the colors around and running this program with a seed you’ve previously used. You’ll get the same structure and distribution of color, but different colors! You can also change things like the scaling of the Perlin noise, or even screw around with the general idea of rendering a quadrilateral, all while retaining the same randomness properties.</p><h4 id="using-other-random-libraries">Using other random libraries</h4><p>It’s not too hard to hook up <code>random-fu</code> to this little framework, which extends its capabilities with e.g. Normally distributed random variables. You can also use other random number generators, as detailed in <a href="http://www.kovach.me/posts/2017-01-30-haskell-bits-randomness.html">my blog post on randomness in Haskell</a>.</p><h4 id="where-did-the-colors-come-from">Where did the colors come from?</h4><p><a href="https://coolors.co">coolors</a>, a handy website. <a href="https://coolors.co/eef4d4-daefb3-ea9e8d-d64550-1c2826">Here’s a link to the palette we used</a>.</p><h4 id="acknowledgements">Acknowledgements</h4><p>A number of people have been super helpful and inspirational to me. To plug a few other generative artists doing cool stuff, check out the work of <a href="http://www.tylerlhobbs.com/">Tyler Hobbs</a>, <a href="http://inconvergent.net">Anders Hoff (inconvergent)</a>, and <a href="http://manoloide.com/">Manoloide</a>. Visit <a href="https://reddit.com/r/generative">r/generative</a> for even more good stuff.</p><p>Also a huge thanks to <a href="https://hackage.haskell.org/package/cairo">the Gtk2Hs team</a> for the cairo bindings, wihout which all of this would not be possible.</p><h4 id="where-can-i-see-your-work">Where can I see your work?</h4><p>I’ve just recently set up a bigcartel shop here, where you can view and purchase my work: <a href="https://bendotk.bigcartel.com">bigcartel link</a>. You can also follow me on <a href="https://instagram.com/bendotk">instagram</a> or <a href="https://instagram.com/bendotk">twitter</a>, where I’ve been posting frequent updates.</p><p>I hope this post provided a glimpse into my general artistic process. as always, feel free to <a href="/contact.html">contact me</a> if you have any questions or comments.</p><p>Ben</p></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2018-03-07">2018-03-07</time></div></div></article><nav class="ui bottom attached segment deemphasized backlinks-container"><h3 class="ui header">Backlinks</h3><ul class="backlinks"><li><span class="zettel-link-container cf"><span class="zettel-link" data-inverted="" data-position="right center" data-tooltip="Tags: home"><a href=".">Ben Kovach</a></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc">Linking by tag: <code>Essays</code></div></li></ul></li></ul><a class="ui right ribbon label zettel-tag " href="search.html?tag=Haskell" title="See all zettels tagged &#39;Haskell&#39;">Haskell</a><p></p><a class="ui right ribbon label zettel-tag " href="search.html?tag=Generative" title="See all zettels tagged &#39;Generative&#39;">Generative</a><p></p><a class="ui right ribbon label zettel-tag " href="search.html?tag=Essays" title="See all zettels tagged &#39;Essays&#39;">Essays</a><p></p></nav></div></div><div class="ui one column grid footer-version"><div class="center aligned column"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron" /></a></div></div></div></div></body></html>